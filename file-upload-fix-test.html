<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload Fix Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-xl font-bold mb-4">File Upload Fix Test</h1>
        
        <!-- ID File Upload (mimicking the structure) -->
        <div id="IDdropzone"
            class="group border-2 border-dashed border-gray-300 p-6 text-center rounded-lg cursor-pointer hover:border-blue-500 transition-all duration-500 ease-in-out">
            <input type="file" id="IDfileInput" accept=".jpg,.jpeg,.png,.webp" class="hidden">
            <div class="flex flex-col items-center justify-center">
                <svg class="w-8 h-8 text-gray-500 group-hover:text-blue-500 mb-2 transition-all duration-500 ease-in-out"
                    fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                </svg>
                <p class="text-sm text-gray-600">Drag and Drop or <span class="text-black font-semibold underline">Choose a Local File</span></p>
                <p class="text-xs text-gray-400 mt-1">Supported formats: .jpg, .jpeg, .png, .webp</p>
            </div>
        </div>

        <!-- Preview Container -->
        <div id="IDpreviewContainer" class="mt-4 flex flex-col gap-3"></div>

        <!-- Test Buttons -->
        <div class="mt-6 space-y-2">
            <button id="testFileAccess" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600">
                Test File Access
            </button>
            <button id="testValidation" class="w-full bg-green-500 text-white p-3 rounded-lg hover:bg-green-600">
                Test Validation
            </button>
        </div>

        <!-- Results -->
        <div class="mt-4">
            <h3 class="font-bold mb-2">Test Results:</h3>
            <div id="results" class="bg-gray-50 p-3 rounded text-sm"></div>
        </div>
    </div>

    <!-- Load the actual scripts -->
    <script src="../../src/IDverifier.js"></script>
    
    <script>
        // Test file access
        document.getElementById('testFileAccess').addEventListener('click', () => {
            const results = document.getElementById('results');
            let output = [];

            // Check stored files
            if (window.uploadedIDFiles) {
                output.push(`✅ Stored files available: ${window.uploadedIDFiles.length} files`);
                window.uploadedIDFiles.forEach((file, index) => {
                    output.push(`  File ${index + 1}: ${file.name} (${Math.round(file.size/1024)}KB)`);
                });
            } else {
                output.push('❌ No stored files found');
            }

            // Check file input
            const fileInput = document.getElementById('IDfileInput');
            if (fileInput && fileInput.files) {
                output.push(`📁 File input has: ${fileInput.files.length} files`);
                Array.from(fileInput.files).forEach((file, index) => {
                    output.push(`  Input File ${index + 1}: ${file.name} (${Math.round(file.size/1024)}KB)`);
                });
            } else {
                output.push('❌ File input not accessible or no files');
            }

            // Check preview container
            const previewContainer = document.getElementById('IDpreviewContainer');
            output.push(`🖼️ Preview container has: ${previewContainer.children.length} previews`);

            results.innerHTML = output.join('<br>');
        });

        // Test validation
        document.getElementById('testValidation').addEventListener('click', () => {
            const results = document.getElementById('results');
            
            // Mock validation function (simplified version)
            function validateStep1Test() {
                const idPreviewContainer = document.getElementById('IDpreviewContainer');
                const hasUploadedFiles = idPreviewContainer && idPreviewContainer.children.length > 0;
                const hasStoredFiles = window.uploadedIDFiles && window.uploadedIDFiles.length > 0;

                let output = [];
                output.push('🔍 Validation Check:');
                output.push(`  Preview container files: ${hasUploadedFiles ? '✅ Found' : '❌ None'}`);
                output.push(`  Stored files: ${hasStoredFiles ? '✅ Found' : '❌ None'}`);
                output.push(`  Overall validation: ${(hasUploadedFiles || hasStoredFiles) ? '✅ PASS' : '❌ FAIL'}`);

                return output;
            }

            const validationResults = validateStep1Test();
            results.innerHTML = validationResults.join('<br>');
        });

        // Add some debug info
        setTimeout(() => {
            const results = document.getElementById('results');
            results.innerHTML = '📝 Upload a file and click "Test File Access" to verify the fix works correctly.';
        }, 100);
    </script>
</body>
</html>
