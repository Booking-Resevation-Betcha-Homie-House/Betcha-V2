<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration OCR Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn {
            @apply px-6 py-3 font-medium text-white rounded-lg transition-all duration-200;
        }
        
        .btn:disabled {
            @apply opacity-50 cursor-not-allowed;
        }
        
        .modal {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
        }
        
        .modal-content {
            @apply bg-white rounded-lg p-6 max-w-md mx-4;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <h1 class="text-2xl font-bold mb-6">Registration OCR Integration Test</h1>
    
    <!-- Test Results -->
    <div id="testResults" class="mb-6 p-4 bg-white rounded-lg">
        <h2 class="text-lg font-semibold mb-3">Test Status:</h2>
        <div id="statusMessages" class="space-y-2"></div>
    </div>

    <!-- Test Registration Form -->
    <div class="max-w-2xl bg-white rounded-lg p-6">
        <!-- Step 1: ID Verification -->
        <div id="step1" class="space-y-4">
            <h2 class="text-xl font-bold">Step 1: ID Verification</h2>
            
            <!-- ID Type Selection -->
            <div>
                <label class="block text-sm font-medium mb-2">Select ID Type:</label>
                <div class="relative">
                    <button id="idTypeDropdown" class="w-full p-3 border rounded-lg text-left bg-white">
                        <span id="selectedID">Select valid ID</span>
                    </button>
                    <div id="idTypeOptions" class="hidden absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg">
                        <div class="p-2 hover:bg-gray-100 cursor-pointer" onclick="selectIDType('Driver\'s License')">Driver's License</div>
                        <div class="p-2 hover:bg-gray-100 cursor-pointer" onclick="selectIDType('Passport')">Passport</div>
                    </div>
                </div>
            </div>
            
            <!-- File Upload -->
            <div>
                <label class="block text-sm font-medium mb-2">Upload ID Image:</label>
                <input type="file" id="IDfileInput" accept="image/*" class="w-full p-3 border rounded-lg">
                <div id="IDpreviewContainer" class="mt-2"></div>
            </div>
            
            <!-- Next Button -->
            <button id="nextBtn1" type="button" onclick="goToStep2()" 
                    class="group relative w-full bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition-colors flex items-center justify-center overflow-hidden">
                <span class="text-white text-base group-hover:-translate-x-1 transition-transform duration-500 ease-in-out">Next</span>
                <span class="overflow-hidden max-w-[30px] transition-all duration-500 ease-in-out">
                    <svg class="w-5 h-5 ml-2 fill-white" viewBox="0 0 24 25" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.707 6.13598L20.364 11.793C20.5515 11.9805 20.6568 12.2348 20.6568 12.5C20.6568 12.7651 20.5515 13.0194 20.364 13.207L14.707 18.864C14.5184 19.0461 14.2658 19.1469 14.0036 19.1447C13.7414 19.1424 13.4906 19.0372 13.3052 18.8518C13.1198 18.6664 13.0146 18.4156 13.0123 18.1534C13.01 17.8912 13.1108 17.6386 13.293 17.45L17.243 13.5H4C3.73478 13.5 3.48043 13.3946 3.29289 13.2071C3.10536 13.0195 3 12.7652 3 12.5C3 12.2348 3.10536 11.9804 3.29289 11.7929C3.48043 11.6053 3.73478 11.5 4 11.5H17.243L13.293 7.54998C13.1975 7.45773 13.1213 7.34739 13.0689 7.22538C13.0165 7.10338 12.9889 6.97216 12.9877 6.83938C12.9866 6.7066 13.0119 6.57492 13.0622 6.45202C13.1125 6.32913 13.1867 6.21747 13.2806 6.12358C13.3745 6.02969 13.4861 5.95544 13.609 5.90516C13.7319 5.85487 13.8636 5.82957 13.9964 5.83073C14.1292 5.83188 14.2604 5.85947 14.3824 5.91188C14.5044 5.96428 14.6148 6.04047 14.707 6.13598Z" />
                    </svg>
                </span>
            </button>
        </div>

        <!-- Step 2: Personal Information -->
        <div id="step2" class="hidden space-y-4">
            <h2 class="text-xl font-bold">Step 2: Personal Information</h2>
            
            <div class="grid grid-cols-3 gap-4">
                <input type="text" placeholder="First name" class="p-3 border rounded-lg">
                <input type="text" placeholder="Middle name" class="p-3 border rounded-lg">
                <input type="text" placeholder="Last name" class="p-3 border rounded-lg">
            </div>
            
            <!-- Birthday Dropdowns -->
            <div class="grid grid-cols-3 gap-4">
                <div class="relative">
                    <button class="w-full p-3 border rounded-lg text-left">
                        <span id="selectedMonth" class="text-gray-400">Month</span>
                    </button>
                </div>
                <div class="relative">
                    <button class="w-full p-3 border rounded-lg text-left">
                        <span id="selectedDay" class="text-gray-400">Day</span>
                    </button>
                </div>
                <div class="relative">
                    <button class="w-full p-3 border rounded-lg text-left">
                        <span id="selectedYear" class="text-gray-400">Year</span>
                    </button>
                </div>
            </div>
            
            <button onclick="goToStep3()" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors">
                Next
            </button>
        </div>

        <!-- Step 3: Final Step -->
        <div id="step3" class="hidden space-y-4">
            <h2 class="text-xl font-bold">Step 3: Contact Information</h2>
            <p class="text-gray-600">Registration form would be completed here.</p>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="max-w-2xl mt-4">
        <div class="bg-gray-200 rounded-full h-2">
            <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 33.33%"></div>
        </div>
        <p id="step-label" class="text-center mt-2 text-sm text-gray-600">Step 1 of 3</p>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold mb-3 text-red-600">Error</h3>
            <p id="errorMessage" class="text-gray-700 mb-4"></p>
            <button onclick="closeErrorModal()" class="w-full bg-red-600 text-white p-2 rounded hover:bg-red-700 transition-colors">
                Close
            </button>
        </div>
    </div>

    <script>
        // Test logging
        function logTest(message, status = 'info') {
            const statusDiv = document.getElementById('statusMessages');
            const logItem = document.createElement('div');
            logItem.className = `p-2 rounded text-sm ${
                status === 'success' ? 'bg-green-100 text-green-800' : 
                status === 'error' ? 'bg-red-100 text-red-800' : 
                'bg-blue-100 text-blue-800'
            }`;
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            statusDiv.appendChild(logItem);
        }

        // Mock showError function for testing
        window.showError = function(message) {
            logTest(`Error modal would show: ${message}`, 'error');
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').classList.remove('hidden');
        };

        function closeErrorModal() {
            document.getElementById('errorModal').classList.add('hidden');
        }

        // ID Type selection
        function selectIDType(type) {
            document.getElementById('selectedID').textContent = type;
            document.getElementById('idTypeOptions').classList.add('hidden');
            logTest(`Selected ID type: ${type}`, 'info');
        }

        // Toggle dropdown
        document.getElementById('idTypeDropdown').onclick = function() {
            document.getElementById('idTypeOptions').classList.toggle('hidden');
        };

        // File upload preview
        document.getElementById('IDfileInput').onchange = function(event) {
            const file = event.target.files[0];
            const container = document.getElementById('IDpreviewContainer');
            
            if (file) {
                container.innerHTML = `<div class="text-sm text-green-600">✓ File uploaded: ${file.name}</div>`;
                logTest(`File uploaded: ${file.name} (${file.size} bytes)`, 'success');
            } else {
                container.innerHTML = '';
            }
        };

        // Step validation
        function validateStep1() {
            const selectedID = document.getElementById('selectedID').textContent.trim();
            const fileInput = document.getElementById('IDfileInput');
            
            if (!selectedID || selectedID === 'Select valid ID') {
                showError('Please select a valid ID type first.');
                return false;
            }
            
            if (selectedID !== "Driver's License") {
                showError('Only Driver\'s License scanning is currently supported.');
                return false;
            }
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showError('Please upload your driver\'s license image first.');
                return false;
            }
            
            logTest('Step 1 validation passed', 'success');
            return true;
        }

        // Initialize test
        logTest('Registration OCR test page loaded', 'info');
        logTest('Testing the nextBtn1 OCR integration...', 'info');
        
        // Add a demo button to test loading state
        const demoBtn = document.createElement('button');
        demoBtn.textContent = 'Demo Loading State';
        demoBtn.className = 'mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700';
        demoBtn.onclick = function() {
            const btn = document.getElementById('nextBtn1');
            const textSpan = btn.querySelector('span');
            const arrowSpan = btn.querySelector('span:last-child');
            const originalText = textSpan.textContent;
            
            // Show loading
            btn.disabled = true;
            btn.classList.add('opacity-75');
            textSpan.textContent = 'Processing...';
            arrowSpan.innerHTML = `
                <svg class="w-5 h-5 ml-2 animate-spin text-white" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            `;
            
            logTest('Loading state activated with spinner', 'info');
            
            // Reset after 3 seconds
            setTimeout(() => {
                btn.disabled = false;
                btn.classList.remove('opacity-75');
                textSpan.textContent = originalText;
                arrowSpan.innerHTML = `
                    <svg class="w-5 h-5 ml-2 fill-white" viewBox="0 0 24 25" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.707 6.13598L20.364 11.793C20.5515 11.9805 20.6568 12.2348 20.6568 12.5C20.6568 12.7651 20.5515 13.0194 20.364 13.207L14.707 18.864C14.5184 19.0461 14.2658 19.1469 14.0036 19.1447C13.7414 19.1424 13.4906 19.0372 13.3052 18.8518C13.1198 18.6664 13.0146 18.4156 13.0123 18.1534C13.01 17.8912 13.1108 17.6386 13.293 17.45L17.243 13.5H4C3.73478 13.5 3.48043 13.3946 3.29289 13.2071C3.10536 13.0195 3 12.7652 3 12.5C3 12.2348 3.10536 11.9804 3.29289 11.7929C3.48043 11.6053 3.73478 11.5 4 11.5H17.243L13.293 7.54998C13.1975 7.45773 13.1213 7.34739 13.0689 7.22538C13.0165 7.10338 12.9889 6.97216 12.9877 6.83938C12.9866 6.7066 13.0119 6.57492 13.0622 6.45202C13.1125 6.32913 13.1867 6.21747 13.2806 6.12358C13.3745 6.02969 13.4861 5.95544 13.609 5.90516C13.7319 5.85487 13.8636 5.82957 13.9964 5.83073C14.1292 5.83188 14.2604 5.85947 14.3824 5.91188C14.5044 5.96428 14.6148 6.04047 14.707 6.13598Z" />
                    </svg>
                `;
                logTest('Loading state reset to normal', 'success');
            }, 3000);
        };
        
        document.querySelector('.max-w-2xl').appendChild(demoBtn);
    </script>

    <!-- Load the actual registration functions -->
    <script src="./pages/unauth/unauthFunctions/registerPage-functions.js"></script>
    <script src="./src/userInputs.js"></script>

    <script>
        // Override the original window functions for testing
        const originalGoToStep2 = window.goToStep2;
        const originalGoToStep3 = window.goToStep3;
        
        window.goToStep2 = function() {
            logTest('goToStep2 function called (from onclick attribute)', 'info');
            if (originalGoToStep2) {
                return originalGoToStep2();
            }
        };
        
        window.goToStep3 = function() {
            logTest('Moving to Step 3', 'info');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('step-label').textContent = 'Step 3 of 3';
        };
        
        // Test that the event listener is working
        document.addEventListener('DOMContentLoaded', () => {
            logTest('DOM loaded, checking for nextBtn1 event listener...', 'info');
            
            const nextBtn1 = document.getElementById('nextBtn1');
            if (nextBtn1) {
                const listeners = getEventListeners && getEventListeners(nextBtn1);
                if (listeners && listeners.click && listeners.click.length > 0) {
                    logTest('✓ Event listeners found on nextBtn1', 'success');
                } else {
                    logTest('⚠ Could not detect event listeners (this is normal in production)', 'info');
                }
            }
        });
    </script>
</body>
</html>
