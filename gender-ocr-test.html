<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gender Field OCR Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold mb-6 text-center">Gender Field OCR Test</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Mock Form Controls -->
            <div class="space-y-4">
                <h2 class="text-lg font-semibold">Mock Step 2 Form</h2>
                
                <!-- First Name -->
                <div>
                    <label class="block text-sm font-medium mb-2">First Name</label>
                    <input type="text" placeholder="First name" class="w-full p-3 border border-gray-300 rounded-lg" readonly>
                </div>
                
                <!-- Last Name -->
                <div>
                    <label class="block text-sm font-medium mb-2">Last Name</label>
                    <input type="text" placeholder="Last name" class="w-full p-3 border border-gray-300 rounded-lg" readonly>
                </div>
                
                <!-- Middle Name -->
                <div>
                    <label class="block text-sm font-medium mb-2">Middle Name</label>
                    <input type="text" placeholder="Middle name" class="w-full p-3 border border-gray-300 rounded-lg" readonly>
                </div>
                
                <!-- Sex Dropdown -->
                <div>
                    <label class="block text-sm font-medium mb-2">Sex</label>
                    <div class="relative">
                        <button type="button" class="w-full p-3 border border-gray-300 rounded-lg flex justify-between items-center">
                            <span id="selectedSex" class="text-gray-500">Sex</span>
                            <svg class="w-4 h-4" viewBox="0 0 16 10">
                                <path d="M1 1.5L8 8.5L15 1.5" stroke="#666666" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Birthdate -->
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium mb-2">Month</label>
                        <div class="p-3 border border-gray-300 rounded-lg">
                            <span id="selectedMonth" class="text-gray-500">Month</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Day</label>
                        <div class="p-3 border border-gray-300 rounded-lg">
                            <span id="selectedDay" class="text-gray-500">Day</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Year</label>
                        <div class="p-3 border border-gray-300 rounded-lg">
                            <span id="selectedYear" class="text-gray-500">Year</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Test Controls -->
            <div class="space-y-4">
                <h2 class="text-lg font-semibold">Test OCR Data</h2>
                
                <!-- Test Buttons -->
                <div class="space-y-2">
                    <button id="testMaleGender" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600">
                        Test Male Gender
                    </button>
                    <button id="testFemaleGender" class="w-full bg-pink-500 text-white p-3 rounded-lg hover:bg-pink-600">
                        Test Female Gender
                    </button>
                    <button id="testVariations" class="w-full bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600">
                        Test Gender Variations (M/F)
                    </button>
                    <button id="clearForm" class="w-full bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600">
                        Clear Form
                    </button>
                </div>
                
                <!-- Expected vs Actual -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2">Test Results:</h3>
                    <div id="testResults" class="space-y-1 text-sm"></div>
                </div>
                
                <!-- Console Output -->
                <div>
                    <h3 class="font-bold mb-2">Console Output:</h3>
                    <div id="console-output" class="bg-gray-100 p-3 rounded text-xs max-h-32 overflow-y-auto font-mono"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Console logging
        const originalLog = console.log;
        const originalWarn = console.warn;
        const consoleOutput = document.getElementById('console-output');
        
        function addConsoleLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type === 'warn' ? 'text-yellow-600' : 'text-gray-700';
            logEntry.textContent = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addConsoleLog(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addConsoleLog(args.join(' '), 'warn');
        };

        // Mock auto-fill function (copied from the actual implementation)
        function autoFillFromOCR(ocrData) {
            try {
                console.log('Auto-filling form with OCR data:', JSON.stringify(ocrData));
                
                // Fill first name
                if (ocrData.firstName) {
                    const firstNameInput = document.querySelector('input[placeholder="First name"]');
                    if (firstNameInput) {
                        firstNameInput.value = ocrData.firstName;
                    }
                }
                
                // Fill last name
                if (ocrData.lastName) {
                    const lastNameInput = document.querySelector('input[placeholder="Last name"]');
                    if (lastNameInput) {
                        lastNameInput.value = ocrData.lastName;
                    }
                }
                
                // Fill middle name
                if (ocrData.middleName) {
                    const middleNameInput = document.querySelector('input[placeholder="Middle name"]');
                    if (middleNameInput) {
                        middleNameInput.value = ocrData.middleName;
                    }
                }
                
                // Fill sex/gender (check both 'gender' and 'sex' fields)
                const genderValue = ocrData.gender || ocrData.sex;
                if (genderValue) {
                    const sexDisplay = document.querySelector('#selectedSex');
                    if (sexDisplay) {
                        // Convert to proper case and ensure it matches dropdown options
                        let displayValue = genderValue.charAt(0).toUpperCase() + genderValue.slice(1).toLowerCase();
                        
                        // Map common variations to dropdown options
                        if (displayValue === 'M' || displayValue === 'Male') {
                            displayValue = 'Male';
                        } else if (displayValue === 'F' || displayValue === 'Female') {
                            displayValue = 'Female';
                        }
                        
                        // Validate against allowed options (Male, Female, Other)
                        const allowedValues = ['Male', 'Female', 'Other'];
                        if (allowedValues.includes(displayValue)) {
                            sexDisplay.textContent = displayValue;
                            sexDisplay.classList.remove('text-gray-500');
                            sexDisplay.classList.add('text-gray-800');
                            console.log('Gender auto-filled:', displayValue);
                        } else {
                            console.warn('Unknown gender value from OCR:', genderValue);
                        }
                    }
                }
                
                // Fill birthdate
                if (ocrData.birthday) {
                    try {
                        const [year, month, day] = ocrData.birthday.split('/');
                        
                        // Set month
                        const monthDisplay = document.querySelector('#selectedMonth');
                        if (monthDisplay) {
                            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            monthDisplay.textContent = months[parseInt(month) - 1];
                            monthDisplay.dataset.value = month;
                            monthDisplay.classList.remove('text-gray-500');
                            monthDisplay.classList.add('text-gray-800');
                        }
                        
                        // Set day
                        const dayDisplay = document.querySelector('#selectedDay');
                        if (dayDisplay) {
                            dayDisplay.textContent = parseInt(day).toString();
                            dayDisplay.classList.remove('text-gray-500');
                            dayDisplay.classList.add('text-gray-800');
                        }
                        
                        // Set year
                        const yearDisplay = document.querySelector('#selectedYear');
                        if (yearDisplay) {
                            yearDisplay.textContent = year;
                            yearDisplay.classList.remove('text-gray-500');
                            yearDisplay.classList.add('text-gray-800');
                        }
                    } catch (error) {
                        console.error('Error parsing birthdate:', error);
                    }
                }
                
                console.log('Form auto-fill completed');
            } catch (error) {
                console.error('Error auto-filling form:', error);
            }
        }

        function updateTestResults(expected, actual) {
            const resultsDiv = document.getElementById('testResults');
            const isMatch = expected === actual;
            resultsDiv.innerHTML = `
                <div class="flex justify-between">
                    <span>Expected:</span>
                    <span class="font-mono">${expected}</span>
                </div>
                <div class="flex justify-between">
                    <span>Actual:</span>
                    <span class="font-mono">${actual}</span>
                </div>
                <div class="flex justify-between font-bold">
                    <span>Result:</span>
                    <span class="${isMatch ? 'text-green-600' : 'text-red-600'}">${isMatch ? '✅ PASS' : '❌ FAIL'}</span>
                </div>
            `;
        }

        function clearForm() {
            // Clear inputs
            document.querySelectorAll('input').forEach(input => input.value = '');
            
            // Reset dropdowns
            document.getElementById('selectedSex').textContent = 'Sex';
            document.getElementById('selectedSex').className = 'text-gray-500';
            
            document.getElementById('selectedMonth').textContent = 'Month';
            document.getElementById('selectedMonth').className = 'text-gray-500';
            
            document.getElementById('selectedDay').textContent = 'Day';
            document.getElementById('selectedDay').className = 'text-gray-500';
            
            document.getElementById('selectedYear').textContent = 'Year';
            document.getElementById('selectedYear').className = 'text-gray-500';
            
            document.getElementById('testResults').innerHTML = '';
            console.log('Form cleared');
        }

        // Test buttons
        document.getElementById('testMaleGender').addEventListener('click', () => {
            clearForm();
            const mockData = {
                "birthday": "2002/04/14",
                "firstName": "Luke",
                "lastName": "Bumengeg",
                "middleName": "Nabal-I",
                "gender": "Male"
            };
            autoFillFromOCR(mockData);
            updateTestResults('Male', document.getElementById('selectedSex').textContent);
        });

        document.getElementById('testFemaleGender').addEventListener('click', () => {
            clearForm();
            const mockData = {
                "birthday": "1995/08/22",
                "firstName": "Maria",
                "lastName": "Santos",
                "middleName": "Cruz",
                "gender": "Female"
            };
            autoFillFromOCR(mockData);
            updateTestResults('Female', document.getElementById('selectedSex').textContent);
        });

        document.getElementById('testVariations').addEventListener('click', () => {
            clearForm();
            const mockData = {
                "birthday": "1990/12/01",
                "firstName": "Test",
                "lastName": "User",
                "gender": "M"  // Test single letter variation
            };
            autoFillFromOCR(mockData);
            updateTestResults('Male', document.getElementById('selectedSex').textContent);
        });

        document.getElementById('clearForm').addEventListener('click', clearForm);

        console.log('Gender field OCR test initialized');
    </script>
</body>
</html>
