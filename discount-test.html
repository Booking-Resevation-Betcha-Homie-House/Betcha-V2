<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/src/index.css">
    <title>Discount Test</title>
</head>
<body class="bg-background p-10">
    <div class="max-w-lg mx-auto bg-white p-8 rounded-3xl shadow-sm border border-neutral-300">
        <h1 class="text-2xl font-bold mb-6">Discount Display Test</h1>
        
        <!-- Mock price details like confirm-payment page -->
        <div class="w-full">
            <p class="text-primary-text font-bold font-manrope">Price details</p>
            
            <div class="flex justify-between items-center">
                <div class="text-primary-text font-inter">
                    <p>‚Ç± <span id="pricePerDay">100</span><span> x </span> <span id="daysOfStay">3</span> <span>day/s</span></p>
                </div>
                <p class="text-primary-text font-inter">‚Ç± <span id="totalPriceDay">300</span></p>
            </div>
            
            <div class="flex justify-between items-center mb-5">
                <div class="text-primary-text font-inter">
                    <p>‚Ç± <span id="addGuestPrice">50</span><span> x </span> <span id="addGuestCount">2</span> <span>guest/s</span></p>
                </div>
                <p class="text-primary-text font-inter">‚Ç± <span id="totalAddGuest">100</span></p>
            </div>
            
            <div class="flex justify-between items-center mb-5">
                <p class="text-primary-text font-bold font-manrope">Reservation fee</p>
                <p class="text-primary-text font-inter">‚Ç± <span id="reservationFee">100</span></p>
            </div>
            
            <!-- Discount Section (copied from confirm-payment.html) -->
            <div id="discountSection" class="flex justify-between items-center mb-2" style="display: flex;">
                <p class="text-green-600 font-bold font-manrope">Discount (<span id="discountPercentage">10.5%</span>)</p>
                <p class="text-green-600 font-inter">-‚Ç± <span id="discount">50</span></p>
            </div>
            
            <div class="h-[1px] w-full border border-neutral-300 mb-5"></div>
            <div class="flex justify-between items-center">
                <p class="text-primary-text text-xl font-bold font-manrope">Total:</p>
                <p class="text-primary-text text-xl font-inter">‚Ç± <span id="totalPrice">450</span></p>
            </div>
        </div>
        
        <div class="mt-8">
            <h2 class="text-lg font-bold mb-4">Test Controls</h2>
            <button id="showDiscount" class="bg-green-500 text-white px-4 py-2 rounded mr-2">Show Discount</button>
            <button id="hideDiscount" class="bg-red-500 text-white px-4 py-2 rounded mr-2">Hide Discount</button>
            <button id="simulateNoDiscount" class="bg-blue-500 text-white px-4 py-2 rounded mr-2">Simulate No Discount</button>
            <button id="simulateWithDiscount" class="bg-purple-500 text-white px-4 py-2 rounded">Simulate With Discount</button>
        </div>
    </div>

    <script>
        // Test controls
        document.getElementById('showDiscount').addEventListener('click', function() {
            const discountSection = document.getElementById('discountSection');
            if (discountSection) {
                discountSection.style.display = 'flex';
                console.log('‚úÖ Discount section shown');
            }
        });
        
        document.getElementById('hideDiscount').addEventListener('click', function() {
            const discountSection = document.getElementById('discountSection');
            if (discountSection) {
                discountSection.style.display = 'none';
                console.log('‚ùå Discount section hidden');
            }
        });
        
        // Simulate populateElement function from confirm-payment-functions.js
        function populateElement(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
                console.log(`Populated ${elementId} with: ${value}`);
            } else {
                console.warn(`Element with ID '${elementId}' not found`);
            }
        }
        
        // Simulate handling discount logic like in confirm-payment-functions.js
        function handleDiscountDisplay(discount, discountPercentage) {
            console.log('üé® Processing discount display:', { discount, discountPercentage });
            
            const discountSection = document.getElementById('discountSection');
            console.log('üîç Discount section element found:', !!discountSection);
            
            if (discount > 0) {
                console.log('‚úÖ Discount found, showing discount section');
                populateElement('discount', discount.toLocaleString());
                populateElement('discountPercentage', `${discountPercentage}%`);
                
                // Show discount section
                if (discountSection) {
                    discountSection.style.display = 'flex';
                    console.log('‚úÖ Discount section made visible');
                }
            } else {
                console.log('‚ùå No discount found, hiding discount section');
                // Hide discount section if no discount
                if (discountSection) {
                    discountSection.style.display = 'none';
                    console.log('‚úÖ Discount section hidden');
                }
            }
        }
        
        document.getElementById('simulateNoDiscount').addEventListener('click', function() {
            console.log('üß™ Simulating booking with no discount');
            handleDiscountDisplay(0, 0);
        });
        
        document.getElementById('simulateWithDiscount').addEventListener('click', function() {
            console.log('üß™ Simulating booking with discount');
            handleDiscountDisplay(75, 15.5);
        });
        
        // Test the discount calculation function from confirm-payment-functions.js
        function calculateDiscountPercentage(booking) {
            try {
                const discount = booking.discount || 0;
                const totalFee = booking.totalFee || 0;
                
                if (discount === 0 || totalFee === 0) {
                    return 0;
                }
                
                // Calculate the original total before discount
                const originalTotal = totalFee + discount;
                
                // Calculate percentage: (discount / originalTotal) * 100
                const percentage = (discount / originalTotal) * 100;
                
                // Round to 1 decimal place
                const roundedPercentage = Math.round(percentage * 10) / 10;
                
                console.log('Discount percentage calculation:', {
                    discount,
                    totalFee,
                    originalTotal,
                    percentage,
                    roundedPercentage
                });
                
                return roundedPercentage;
            } catch (error) {
                console.error('Error calculating discount percentage:', error);
                return 0;
            }
        }
        
        // Test with mock booking data
        const mockBooking1 = { discount: 50, totalFee: 450 }; // Should give 10% discount
        const mockBooking2 = { discount: 0, totalFee: 500 }; // Should give 0% discount
        const mockBooking3 = { discount: 75, totalFee: 425 }; // Should give 15% discount
        
        console.log('üß™ Testing discount calculations:');
        console.log('Mock booking 1:', calculateDiscountPercentage(mockBooking1) + '%');
        console.log('Mock booking 2:', calculateDiscountPercentage(mockBooking2) + '%');
        console.log('Mock booking 3:', calculateDiscountPercentage(mockBooking3) + '%');
    </script>
</body>
</html>
