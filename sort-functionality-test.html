<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sort Functionality Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .rotate-180 {
            transform: rotate(180deg);
        }
        .transition-transform {
            transition: transform 0.3s ease-in-out;
        }
        .input-style {
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            background-color: white;
        }
        .input-style:hover {
            border-color: #9ca3af;
        }
        .text-muted {
            color: #9ca3af;
        }
        .text-primary-text {
            color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Top Rentals by Earnings - Sort Functionality Test</h1>
        
        <div class="bg-white rounded-2xl shadow-md p-6 h-[500px] flex flex-col">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-5">
                <p class="text-2xl font-bold text-gray-800 mb-4">Top Rentals by Earnings</p>
                <div class="flex gap-2 w-full md:w-auto flex-wrap">
                    <!-- Sort Options -->
                    <div class="relative w-full md:w-40">
                        <button type="button" id="sortDropdownBtn" class="input-style flex justify-between items-center w-full group">
                            <span id="selectedSort" class="text-muted text-sm md:text-base">Sort By</span>
                            <svg id="sortDropdownIcon" class="w-4 md:w-5 stroke-gray-400 transition-transform duration-300" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1.5L8 8.5L15 1.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="bevel" />
                            </svg>
                        </button>
                        <ul id="sortDropdownList" class="absolute z-10 mt-1 bg-white w-full border border-gray-300 rounded-xl shadow hidden text-sm md:text-base text-gray-800 max-h-48 overflow-y-auto">
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-sort="earnings-desc">Highest Earnings</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-sort="earnings-asc">Lowest Earnings</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-sort="name-asc">Name A-Z</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-sort="name-desc">Name Z-A</li>
                        </ul>
                    </div>
                    <!-- Month Filter -->
                    <div class="relative w-full md:w-40">
                        <button type="button" id="monthDropdownBtn" class="input-style flex justify-between items-center w-full group">
                            <span id="selectedMonth" class="text-muted text-sm md:text-base">Month</span>
                            <svg id="monthDropdownIcon" class="w-4 md:w-5 stroke-gray-400 transition-transform duration-300" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1.5L8 8.5L15 1.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="bevel" />
                            </svg>
                        </button>
                        <ul id="monthDropdownList" class="absolute z-10 mt-1 bg-white w-full border border-gray-300 rounded-xl shadow hidden text-sm md:text-base text-gray-800 max-h-48 overflow-y-auto">
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="all">All Months</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="01">January</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="02">February</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="03">March</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="04">April</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="05">May</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="06">June</li>
                        </ul>
                    </div>
                    <!-- Year Filter -->
                    <div class="relative w-full md:w-40">
                        <button type="button" id="yearDropdownBtn" class="input-style flex justify-between items-center w-full group">
                            <span id="selectedYear" class="text-muted text-sm md:text-base">Year</span>
                            <svg id="yearDropdownIcon" class="w-4 md:w-5 stroke-gray-400 transition-transform duration-300" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1.5L8 8.5L15 1.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="bevel" />
                            </svg>
                        </button>
                        <ul id="yearDropdownList" class="absolute z-10 mt-1 bg-white w-full border border-gray-300 rounded-xl shadow hidden text-sm md:text-base text-gray-800 max-h-48 overflow-y-auto">
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="all">All Years</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="2024">2024</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="2025">2025</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="flex-1 overflow-hidden relative">
                <canvas id="topRoomsChart" class="w-full h-full"></canvas>
            </div>
        </div>
        
        <div class="mt-8 p-4 bg-blue-50 rounded-lg">
            <h3 class="font-bold text-lg mb-2">Sort Functionality Features:</h3>
            <ul class="list-disc list-inside space-y-1 text-sm">
                <li><strong>Highest Earnings:</strong> Sort properties from highest to lowest earnings</li>
                <li><strong>Lowest Earnings:</strong> Sort properties from lowest to highest earnings</li>
                <li><strong>Name A-Z:</strong> Sort properties alphabetically by name</li>
                <li><strong>Name Z-A:</strong> Sort properties reverse alphabetically by name</li>
            </ul>
            
            <h3 class="font-bold text-lg mb-2 mt-4">How to test:</h3>
            <ol class="list-decimal list-inside space-y-1 text-sm">
                <li>Click the "Sort By" dropdown to see available sorting options</li>
                <li>Select any sorting option to see the chart update</li>
                <li>The chart bars will re-order based on your selection</li>
                <li>The dropdown will show your current selection</li>
            </ol>
        </div>
    </div>

    <script>
        // Sample data for testing
        const sampleData = [
            { propertyName: "Ocean View Villa", totalEarnings: 15000 },
            { propertyName: "Mountain Cabin", totalEarnings: 8500 },
            { propertyName: "City Apartment", totalEarnings: 12000 },
            { propertyName: "Beach House", totalEarnings: 18500 },
            { propertyName: "Garden Lodge", totalEarnings: 6200 },
            { propertyName: "Penthouse Suite", totalEarnings: 22000 },
            { propertyName: "Cozy Cottage", totalEarnings: 4500 },
            { propertyName: "Modern Loft", totalEarnings: 9800 }
        ];

        let currentChart = null;
        let currentSortOrder = 'earnings-desc';

        // Initialize the test
        document.addEventListener('DOMContentLoaded', function() {
            initializeSortDropdown();
            createChart(sampleData);
        });

        function initializeSortDropdown() {
            const sortDropdownBtn = document.getElementById('sortDropdownBtn');
            const sortDropdownList = document.getElementById('sortDropdownList');
            const sortDropdownIcon = document.getElementById('sortDropdownIcon');
            const selectedSortSpan = document.getElementById('selectedSort');
            
            // Toggle dropdown
            sortDropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                sortDropdownList.classList.toggle('hidden');
                sortDropdownIcon.classList.toggle('rotate-180');
            });
            
            // Handle sort option selection
            sortDropdownList.addEventListener('click', function(e) {
                if (e.target.tagName === 'LI') {
                    const sortValue = e.target.getAttribute('data-sort');
                    const sortText = e.target.textContent;
                    
                    // Update UI
                    selectedSortSpan.textContent = sortText;
                    selectedSortSpan.classList.remove('text-muted');
                    selectedSortSpan.classList.add('text-primary-text');
                    
                    // Update current sort order
                    currentSortOrder = sortValue;
                    
                    // Update chart
                    updateChart();
                    
                    // Close dropdown
                    sortDropdownList.classList.add('hidden');
                    sortDropdownIcon.classList.remove('rotate-180');
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                sortDropdownList.classList.add('hidden');
                sortDropdownIcon.classList.remove('rotate-180');
            });
            
            // Set default sort option
            selectedSortSpan.textContent = 'Highest Earnings';
            selectedSortSpan.classList.remove('text-muted');
            selectedSortSpan.classList.add('text-primary-text');
        }

        function sortData(data, sortOrder) {
            const sortedData = [...data];
            
            switch (sortOrder) {
                case 'earnings-desc':
                    return sortedData.sort((a, b) => b.totalEarnings - a.totalEarnings);
                case 'earnings-asc':
                    return sortedData.sort((a, b) => a.totalEarnings - b.totalEarnings);
                case 'name-asc':
                    return sortedData.sort((a, b) => a.propertyName.localeCompare(b.propertyName));
                case 'name-desc':
                    return sortedData.sort((a, b) => b.propertyName.localeCompare(a.propertyName));
                default:
                    return sortedData;
            }
        }

        function createChart(data) {
            const sortedData = sortData(data, currentSortOrder);
            const chartCanvas = document.getElementById('topRoomsChart');
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = chartCanvas.getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedData.map(item => 
                        item.propertyName.length > 15 
                            ? item.propertyName.substring(0, 15) + '...' 
                            : item.propertyName
                    ),
                    datasets: [{
                        label: 'Earnings',
                        data: sortedData.map(item => item.totalEarnings),
                        backgroundColor: 'rgba(99, 102, 241, 0.5)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            callbacks: {
                                label: function(context) {
                                    return `Earnings: ₱${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₱' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            createChart(sampleData);
        }
    </script>
</body>
</html>
