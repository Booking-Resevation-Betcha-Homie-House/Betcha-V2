<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Month/Year Filter Functionality Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .rotate-180 {
            transform: rotate(180deg);
        }
        .transition-transform {
            transition: transform 0.3s ease-in-out;
        }
        .input-style {
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            background-color: white;
        }
        .input-style:hover {
            border-color: #9ca3af;
        }
        .text-muted {
            color: #9ca3af;
        }
        .text-primary-text {
            color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Top Rentals by Earnings - Month/Year Filter Test</h1>
        
        <div class="bg-white rounded-2xl shadow-md p-6 h-[500px] flex flex-col">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-5">
                <p class="text-2xl font-bold text-gray-800 mb-4">Top Rentals by Earnings</p>
                <div class="flex gap-4 w-full md:w-auto">
                    <!-- Month Filter -->
                    <div class="relative w-full md:w-40">
                        <button type="button" id="monthDropdownBtn" class="input-style flex justify-between items-center w-full group">
                            <span id="selectedMonth" class="text-muted text-sm md:text-base">Month</span>
                            <svg id="monthDropdownIcon" class="w-4 md:w-5 stroke-gray-400 transition-transform duration-300" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1.5L8 8.5L15 1.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="bevel" />
                            </svg>
                        </button>
                        <ul id="monthDropdownList" class="absolute z-10 mt-1 bg-white w-full border border-gray-300 rounded-xl shadow hidden text-sm md:text-base text-gray-800 max-h-48 overflow-y-auto">
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="all">All Months</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="01">January</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="02">February</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="03">March</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="04">April</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="05">May</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="06">June</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="07">July</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="08">August</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="09">September</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="10">October</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="11">November</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-month="12">December</li>
                        </ul>
                    </div>
                    <!-- Year Filter -->
                    <div class="relative w-full md:w-40">
                        <button type="button" id="yearDropdownBtn" class="input-style flex justify-between items-center w-full group">
                            <span id="selectedYear" class="text-muted text-sm md:text-base">Year</span>
                            <svg id="yearDropdownIcon" class="w-4 md:w-5 stroke-gray-400 transition-transform duration-300" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1.5L8 8.5L15 1.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="bevel" />
                            </svg>
                        </button>
                        <ul id="yearDropdownList" class="absolute z-10 mt-1 bg-white w-full border border-gray-300 rounded-xl shadow hidden text-sm md:text-base text-gray-800 max-h-48 overflow-y-auto">
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="all">All Years</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="2025">2025</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="2024">2024</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="2023">2023</li>
                            <li class="px-3 py-2 hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-year="2022">2022</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="flex-1 overflow-hidden relative">
                <canvas id="topRoomsChart" class="w-full h-full"></canvas>
            </div>
        </div>
        
        <div class="mt-8 p-4 bg-blue-50 rounded-lg">
            <h3 class="font-bold text-lg mb-2">Filter Functionality Features:</h3>
            <ul class="list-disc list-inside space-y-1 text-sm">
                <li><strong>Month Filter:</strong> Filter properties data by specific month (January - December)</li>
                <li><strong>Year Filter:</strong> Filter properties data by specific year (2022 - 2025)</li>
                <li><strong>All Options:</strong> Show data for all months or all years</li>
                <li><strong>Combined Filtering:</strong> Apply both month and year filters together</li>
                <li><strong>Auto-Sort:</strong> Data is always sorted by highest earnings first</li>
            </ul>
            
            <h3 class="font-bold text-lg mb-2 mt-4">How to test:</h3>
            <ol class="list-decimal list-inside space-y-1 text-sm">
                <li>Click the "Month" dropdown to filter by specific month</li>
                <li>Click the "Year" dropdown to filter by specific year</li>
                <li>Select "All Months" or "All Years" to clear filters</li>
                <li>Combine month and year filters for specific periods</li>
                <li>Notice the chart updates with filtered data, always sorted by highest earnings</li>
            </ol>
            
            <div class="mt-4 p-3 bg-yellow-100 rounded">
                <p class="text-sm"><strong>Note:</strong> In the actual dashboard, these filters will send API requests with month/year parameters to get the filtered data from the server. This test simulates the UI behavior with sample data.</p>
            </div>
        </div>
    </div>

    <script>
        // Sample data for different months/years (simulating API responses)
        const allData = [
            { propertyName: "Ocean View Villa", totalEarnings: 15000, month: "08", year: "2025" },
            { propertyName: "Mountain Cabin", totalEarnings: 8500, month: "07", year: "2025" },
            { propertyName: "City Apartment", totalEarnings: 12000, month: "08", year: "2025" },
            { propertyName: "Beach House", totalEarnings: 18500, month: "06", year: "2025" },
            { propertyName: "Garden Lodge", totalEarnings: 6200, month: "07", year: "2025" },
            { propertyName: "Penthouse Suite", totalEarnings: 22000, month: "08", year: "2025" },
            { propertyName: "Cozy Cottage", totalEarnings: 4500, month: "06", year: "2025" },
            { propertyName: "Modern Loft", totalEarnings: 9800, month: "07", year: "2025" },
            // 2024 data
            { propertyName: "Ocean View Villa", totalEarnings: 13000, month: "08", year: "2024" },
            { propertyName: "Beach House", totalEarnings: 16500, month: "08", year: "2024" },
            { propertyName: "Penthouse Suite", totalEarnings: 19000, month: "08", year: "2024" },
        ];

        let currentChart = null;
        let currentMonthFilter = 'all';
        let currentYearFilter = 'all';

        // Initialize the test
        document.addEventListener('DOMContentLoaded', function() {
            initializeDropdowns();
            updateChart();
        });

        function initializeDropdowns() {
            initializeMonthDropdown();
            initializeYearDropdown();
        }

        function initializeMonthDropdown() {
            const monthDropdownBtn = document.getElementById('monthDropdownBtn');
            const monthDropdownList = document.getElementById('monthDropdownList');
            const monthDropdownIcon = document.getElementById('monthDropdownIcon');
            const selectedMonthSpan = document.getElementById('selectedMonth');
            
            // Toggle dropdown
            monthDropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                monthDropdownList.classList.toggle('hidden');
                monthDropdownIcon.classList.toggle('rotate-180');
            });
            
            // Handle month selection
            monthDropdownList.addEventListener('click', function(e) {
                if (e.target.tagName === 'LI') {
                    const monthValue = e.target.getAttribute('data-month');
                    const monthText = e.target.textContent;
                    
                    // Update UI
                    selectedMonthSpan.textContent = monthText;
                    selectedMonthSpan.classList.remove('text-muted');
                    selectedMonthSpan.classList.add('text-primary-text');
                    
                    // Update filter
                    currentMonthFilter = monthValue;
                    updateChart();
                    
                    // Close dropdown
                    monthDropdownList.classList.add('hidden');
                    monthDropdownIcon.classList.remove('rotate-180');
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                monthDropdownList.classList.add('hidden');
                monthDropdownIcon.classList.remove('rotate-180');
            });
        }

        function initializeYearDropdown() {
            const yearDropdownBtn = document.getElementById('yearDropdownBtn');
            const yearDropdownList = document.getElementById('yearDropdownList');
            const yearDropdownIcon = document.getElementById('yearDropdownIcon');
            const selectedYearSpan = document.getElementById('selectedYear');
            
            // Toggle dropdown
            yearDropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                yearDropdownList.classList.toggle('hidden');
                yearDropdownIcon.classList.toggle('rotate-180');
            });
            
            // Handle year selection
            yearDropdownList.addEventListener('click', function(e) {
                if (e.target.tagName === 'LI') {
                    const yearValue = e.target.getAttribute('data-year');
                    const yearText = e.target.textContent;
                    
                    // Update UI
                    selectedYearSpan.textContent = yearText;
                    selectedYearSpan.classList.remove('text-muted');
                    selectedYearSpan.classList.add('text-primary-text');
                    
                    // Update filter
                    currentYearFilter = yearValue;
                    updateChart();
                    
                    // Close dropdown
                    yearDropdownList.classList.add('hidden');
                    yearDropdownIcon.classList.remove('rotate-180');
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                yearDropdownList.classList.add('hidden');
                yearDropdownIcon.classList.remove('rotate-180');
            });
        }

        function filterData() {
            let filteredData = [...allData];
            
            // Apply month filter
            if (currentMonthFilter !== 'all') {
                filteredData = filteredData.filter(item => item.month === currentMonthFilter);
            }
            
            // Apply year filter
            if (currentYearFilter !== 'all') {
                filteredData = filteredData.filter(item => item.year === currentYearFilter);
            }
            
            // Sort by earnings (highest to lowest)
            filteredData.sort((a, b) => b.totalEarnings - a.totalEarnings);
            
            return filteredData;
        }

        function createChart(data) {
            const chartCanvas = document.getElementById('topRoomsChart');
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = chartCanvas.getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => 
                        item.propertyName.length > 15 
                            ? item.propertyName.substring(0, 15) + '...' 
                            : item.propertyName
                    ),
                    datasets: [{
                        label: 'Earnings',
                        data: data.map(item => item.totalEarnings),
                        backgroundColor: 'rgba(99, 102, 241, 0.5)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            callbacks: {
                                label: function(context) {
                                    const dataIndex = context.dataIndex;
                                    const item = data[dataIndex];
                                    return [
                                        `Earnings: ₱${context.parsed.y.toLocaleString()}`,
                                        `Month: ${getMonthName(item.month)}`,
                                        `Year: ${item.year}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₱' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            const filteredData = filterData();
            createChart(filteredData);
            
            // Show current filter status
            console.log(`Current filters - Month: ${currentMonthFilter}, Year: ${currentYearFilter}`);
            console.log(`Filtered data points: ${filteredData.length}`);
        }

        function getMonthName(monthNumber) {
            const months = {
                '01': 'January', '02': 'February', '03': 'March',
                '04': 'April', '05': 'May', '06': 'June',
                '07': 'July', '08': 'August', '09': 'September',
                '10': 'October', '11': 'November', '12': 'December'
            };
            return months[monthNumber] || monthNumber;
        }
    </script>
</body>
</html>
