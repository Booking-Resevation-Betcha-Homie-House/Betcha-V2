<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM API Outputs Test - All APIs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .api-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .api-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .api-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .api-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        #results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 600px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .api-name {
            font-weight: bold;
            color: #495057;
            font-size: 1.1em;
        }
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-200 { background: #d4edda; color: #155724; }
        .status-400 { background: #f8d7da; color: #721c24; }
        .status-401 { background: #fff3cd; color: #856404; }
        .status-404 { background: #f8d7da; color: #721c24; }
        .status-500 { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>PM API Outputs Test - All APIs Used</h1>
    
    <div class="container">
        <h3>Test Controls</h3>
        <button onclick="testAllAPIs()">Test All APIs</button>
        <button onclick="testIndividualAPI('role')">Test Role API</button>
        <button onclick="testIndividualAPI('checkinToday')">Test Check-in Today API</button>
        <button onclick="testIndividualAPI('bookingStatus')">Test Booking Status API</button>
        <button onclick="testIndividualAPI('updateStatus')">Test Update Status API</button>
        <button onclick="testIndividualAPI('byDate')">Test By Date API</button>
        <button onclick="clearResults()">Clear Results</button>
        <button onclick="checkLocalStorage()">Check Local Storage</button>
    </div>

    <div class="container">
        <h3>Test Data Setup</h3>
        <div>
            <label>Role ID:</label>
            <input type="text" id="roleId" placeholder="Enter Role ID" value="test-role-id" style="width: 200px; padding: 8px; margin: 0 10px;">
        </div>
        <div style="margin-top: 10px;">
            <label>Property ID:</label>
            <input type="text" id="propertyId" placeholder="Enter Property ID" value="685ec7548e71fd2d8829f03d" style="width: 300px; padding: 8px; margin: 0 10px;">
            <button onclick="setTestProperty()">Set Property</button>
        </div>
        <div style="margin-top: 10px;">
            <label>Booking ID:</label>
            <input type="text" id="bookingId" placeholder="Enter Booking ID" value="test-booking-id" style="width: 200px; padding: 8px; margin: 0 10px;">
        </div>
        <div style="margin-top: 10px;">
            <label>Test Date:</label>
            <input type="date" id="testDate" value="2025-01-15" style="padding: 8px; margin: 0 10px;">
        </div>
    </div>

    <div class="container">
        <h3>API Test Results</h3>
        <div id="api-results">
            <p>Click "Test All APIs" to see the outputs of all APIs used in PM functions.</p>
        </div>
    </div>

    <div id="results">
        Ready to test PM API outputs...
    </div>

    <script>
        const API_BASE_URL = 'https://betcha-api.onrender.com';
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            results.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            results.scrollTop = results.scHeight;
            console.log(message);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('api-results').innerHTML = '<p>Click "Test All APIs" to see the outputs of all APIs used in PM functions.</p>';
        }

        function checkLocalStorage() {
            log('=== LOCAL STORAGE CHECK ===');
            const properties = localStorage.getItem('properties');
            if (properties) {
                log('Properties in localStorage: ' + properties, 'success');
                try {
                    const parsed = JSON.parse(properties);
                    log('Parsed properties: ' + JSON.stringify(parsed, null, 2));
                } catch (e) {
                    log('Error parsing properties: ' + e.message, 'error');
                }
            } else {
                log('No properties found in localStorage', 'error');
            }
        }

        function setTestProperty() {
            const propertyId = document.getElementById('propertyId').value;
            if (!propertyId) {
                log('Please enter a property ID', 'error');
                return;
            }
            
            const testProperty = [{
                _id: propertyId,
                name: 'Test Property',
                title: 'Test Property Title'
            }];
            
            localStorage.setItem('properties', JSON.stringify(testProperty));
            log('Set test property in localStorage: ' + propertyId, 'success');
        }

        function updateAPIResults(apiName, status, response, error = null) {
            const apiResults = document.getElementById('api-results');
            const statusClass = status >= 200 && status < 300 ? 'api-success' : 'api-error';
            const statusBadge = `<span class="status-badge status-${Math.floor(status/100)*100}">${status}</span>`;
            
            let resultHTML = `
                <div class="api-section">
                    <div class="api-name">${apiName} ${statusBadge}</div>
                    <div class="${statusClass}">
                        <strong>Status:</strong> ${status}<br>
                        <strong>Response:</strong><br>
                        <pre style="background: white; padding: 10px; border-radius: 4px; overflow-x: auto;">${JSON.stringify(response, null, 2)}</pre>
                        ${error ? `<br><strong>Error:</strong> ${error}` : ''}
                    </div>
                </div>
            `;
            
            apiResults.innerHTML += resultHTML;
        }

        async function testRoleAPI() {
            const roleId = document.getElementById('roleId').value;
            log(`=== TESTING ROLE API: GET /role/${roleId} ===`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/roles/display/${roleId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.text();
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                } catch (e) {
                    parsedData = { raw: data };
                }
                
                log(`Role API Response Status: ${response.status}`);
                log(`Role API Response: ${JSON.stringify(parsedData, null, 2)}`);
                
                updateAPIResults('Role API', response.status, parsedData);
                
                return { status: response.status, data: parsedData };
                
            } catch (error) {
                log(`Role API Error: ${error.message}`, 'error');
                updateAPIResults('Role API', 0, {}, error.message);
                return { status: 0, error: error.message };
            }
        }

        async function testCheckinTodayAPI() {
            const propertyId = document.getElementById('propertyId').value;
            log(`=== TESTING CHECK-IN TODAY API: POST /pm/bookings/checkinToday ===`);
            
            try {
                const requestBody = {
                    propertyIds: [propertyId]
                };
                
                log(`Request Body: ${JSON.stringify(requestBody, null, 2)}`);
                
                const response = await fetch(`${API_BASE_URL}/pm/bookings/checkinToday`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.text();
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                } catch (e) {
                    parsedData = { raw: data };
                }
                
                log(`Check-in Today API Response Status: ${response.status}`);
                log(`Check-in Today API Response: ${JSON.stringify(parsedData, null, 2)}`);
                
                updateAPIResults('Check-in Today API', response.status, parsedData);
                
                return { status: response.status, data: parsedData };
                
            } catch (error) {
                log(`Check-in Today API Error: ${error.message}`, 'error');
                updateAPIResults('Check-in Today API', 0, {}, error.message);
                return { status: 0, error: error.message };
            }
        }

        async function testBookingStatusAPI() {
            const bookingId = document.getElementById('bookingId').value;
            log(`=== TESTING BOOKING STATUS API: GET /booking/${bookingId} ===`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/booking/${bookingId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.text();
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                } catch (e) {
                    parsedData = { raw: data };
                }
                
                log(`Booking Status API Response Status: ${response.status}`);
                log(`Booking Status API Response: ${JSON.stringify(parsedData, null, 2)}`);
                
                updateAPIResults('Booking Status API', response.status, parsedData);
                
                return { status: response.status, data: parsedData };
                
            } catch (error) {
                log(`Booking Status API Error: ${error.message}`, 'error');
                updateAPIResults('Booking Status API', 0, {}, error.message);
                return { status: 0, error: error.message };
            }
        }

        async function testUpdateStatusAPI() {
            const bookingId = document.getElementById('bookingId').value;
            log(`=== TESTING UPDATE STATUS API: PATCH /booking/update-status/${bookingId} ===`);
            
            try {
                const requestBody = {
                    status: 'Checked-Out'
                };
                
                log(`Request Body: ${JSON.stringify(requestBody, null, 2)}`);
                
                const response = await fetch(`${API_BASE_URL}/booking/update-status/${bookingId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.text();
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                } catch (e) {
                    parsedData = { raw: data };
                }
                
                log(`Update Status API Response Status: ${response.status}`);
                log(`Update Status API Response: ${JSON.stringify(parsedData, null, 2)}`);
                
                updateAPIResults('Update Status API', response.status, parsedData);
                
                return { status: response.status, data: parsedData };
                
            } catch (error) {
                log(`Update Status API Error: ${error.message}`, 'error');
                updateAPIResults('Update Status API', 0, {}, error.message);
                return { status: 0, error: error.message };
            }
        }

        async function testByDateAPI() {
            const propertyId = document.getElementById('propertyId').value;
            const testDate = document.getElementById('testDate').value;
            log(`=== TESTING BY DATE API: POST /pm/bookings/byDateAndProperties ===`);
            
            try {
                const requestBody = {
                    checkIn: testDate,
                    propertyIds: [propertyId]
                };
                
                log(`Request Body: ${JSON.stringify(requestBody, null, 2)}`);
                
                const response = await fetch(`${API_BASE_URL}/pm/bookings/byDateAndProperties`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.text();
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                } catch (e) {
                    parsedData = { raw: data };
                }
                
                log(`By Date API Response Status: ${response.status}`);
                log(`By Date API Response: ${JSON.stringify(parsedData, null, 2)}`);
                
                updateAPIResults('By Date API', response.status, parsedData);
                
                return { status: response.status, data: parsedData };
                
            } catch (error) {
                log(`By Date API Error: ${error.message}`, 'error');
                updateAPIResults('By Date API', 0, {}, error.message);
                return { status: 0, error: error.message };
            }
        }

        async function testIndividualAPI(apiType) {
            log(`=== TESTING INDIVIDUAL API: ${apiType.toUpperCase()} ===`);
            
            switch(apiType) {
                case 'role':
                    return await testRoleAPI();
                case 'checkinToday':
                    return await testCheckinTodayAPI();
                case 'bookingStatus':
                    return await testBookingStatusAPI();
                case 'updateStatus':
                    return await testUpdateStatusAPI();
                case 'byDate':
                    return await testByDateAPI();
                default:
                    log(`Unknown API type: ${apiType}`, 'error');
                    return null;
            }
        }

        async function testAllAPIs() {
            log('=== STARTING COMPREHENSIVE API TEST ===');
            
            // Clear previous results
            document.getElementById('api-results').innerHTML = '';
            
            const results = {
                role: await testRoleAPI(),
                checkinToday: await testCheckinTodayAPI(),
                bookingStatus: await testBookingStatusAPI(),
                updateStatus: await testUpdateStatusAPI(),
                byDate: await testByDateAPI()
            };
            
            log('=== API TEST SUMMARY ===');
            Object.keys(results).forEach(api => {
                const result = results[api];
                if (result && result.status) {
                    log(`${api} API: Status ${result.status}`, result.status >= 200 && result.status < 300 ? 'success' : 'error');
                } else {
                    log(`${api} API: Failed`, 'error');
                }
            });
            
            log('=== END COMPREHENSIVE API TEST ===');
            
            return results;
        }

        // Initialize
        log('PM API Outputs Test page loaded');
        log('Click "Test All APIs" to see the outputs of all APIs used in PM functions');
        log('Or test individual APIs to see specific responses');
    </script>
</body>
</html>
