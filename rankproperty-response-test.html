<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RankProperty API Response Handler Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>RankProperty API Response Handler Test</h1>
    
    <div class="test-case">
        <h3>Test Case 1: Empty Object Response (Your Current API)</h3>
        <div id="test1-result">Testing...</div>
    </div>
    
    <div class="test-case">
        <h3>Test Case 2: Response with Empty Array</h3>
        <div id="test2-result">Testing...</div>
    </div>
    
    <div class="test-case">
        <h3>Test Case 3: Response with Data</h3>
        <div id="test3-result">Testing...</div>
    </div>
    
    <div class="test-case">
        <h3>Test Case 4: Response with topProperty Array</h3>
        <div id="test4-result">Testing...</div>
    </div>

    <script>
        // Function to handle API response like the dashboard does
        function processTopPropertiesResponse(topPropertiesData) {
            console.log('Processing response:', topPropertiesData);
            
            let chartData = topPropertiesData;
            if (topPropertiesData && typeof topPropertiesData === 'object') {
                // If the response has a topProperty field, use it
                if (topPropertiesData.topProperty) {
                    chartData = Array.isArray(topPropertiesData.topProperty) ? topPropertiesData.topProperty : [];
                }
                // If the response is an array directly, use it
                else if (Array.isArray(topPropertiesData)) {
                    chartData = topPropertiesData;
                }
                // If it's an empty object or other format, use empty array
                else {
                    chartData = [];
                }
            } else {
                chartData = [];
            }
            
            console.log('Processed chart data:', chartData);
            return chartData;
        }
        
        function testCase(caseNumber, input, description) {
            const resultDiv = document.getElementById(`test${caseNumber}-result`);
            const testDiv = resultDiv.parentElement;
            
            try {
                const result = processTopPropertiesResponse(input);
                const isSuccess = Array.isArray(result);
                
                testDiv.className = `test-case ${isSuccess ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <strong>Input:</strong><br>
                    <pre>${JSON.stringify(input, null, 2)}</pre>
                    <strong>Output:</strong><br>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                    <strong>Result:</strong> ${isSuccess ? '✅ Success - Returns array' : '❌ Failed - Not an array'}
                `;
            } catch (error) {
                testDiv.className = 'test-case error';
                resultDiv.innerHTML = `
                    <strong>Error:</strong> ${error.message}<br>
                    <pre>${JSON.stringify(input, null, 2)}</pre>
                `;
            }
        }
        
        // Run tests
        document.addEventListener('DOMContentLoaded', function() {
            // Test Case 1: Your current API response
            testCase(1, { topProperty: {} }, 'Empty object in topProperty');
            
            // Test Case 2: Empty array response
            testCase(2, [], 'Direct empty array');
            
            // Test Case 3: Response with actual data
            testCase(3, [
                { propertyName: 'Resort A', totalEarnings: 15000 },
                { propertyName: 'Resort B', totalEarnings: 12000 }
            ], 'Array with property data');
            
            // Test Case 4: Response with topProperty containing array
            testCase(4, {
                topProperty: [
                    { propertyName: 'Resort C', totalEarnings: 8000 }
                ]
            }, 'Object with topProperty array');
        });
    </script>
</body>
</html>
