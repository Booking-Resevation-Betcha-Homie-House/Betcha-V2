<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Age Validation Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold mb-6">Enhanced Age Validation Test</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Current Implementation Test -->
            <div>
                <h2 class="text-xl font-semibold mb-4">Current Date & Edge Cases</h2>
                <div class="space-y-4">
                    <div>
                        <p><strong>Today:</strong> <span id="currentDate"></span></p>
                        <p><strong>Time:</strong> <span id="currentTime"></span></p>
                    </div>
                    
                    <button onclick="runEdgeCaseTests()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        Test Edge Cases
                    </button>
                </div>
                
                <div id="edgeResults" class="mt-4 space-y-2"></div>
            </div>
            
            <!-- Interactive Test -->
            <div>
                <h2 class="text-xl font-semibold mb-4">Manual Test</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Birth Month:</label>
                        <input type="number" id="testMonth" min="1" max="12" value="1" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Birth Day:</label>
                        <input type="number" id="testDay" min="1" max="31" value="1" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Birth Year:</label>
                        <input type="number" id="testYear" value="2006" class="w-full border rounded px-3 py-2">
                    </div>
                    
                    <button onclick="testManualInput()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        Test This Date
                    </button>
                </div>
                
                <div id="manualResult" class="mt-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Copy the exact functions from registerPage-functions.js
        function calculateAge(birthMonth, birthDay, birthYear) {
            const today = new Date();
            const birthDate = new Date(birthYear, birthMonth - 1, birthDay); // month is 0-indexed
            
            // Calculate age in years
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            // If birthday hasn't occurred this year, subtract a year
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            return age;
        }

        function isAtLeast18Today(birthMonth, birthDay, birthYear) {
            const age = calculateAge(birthMonth, birthDay, birthYear);
            const today = new Date();
            
            // Must be at least 18 years old as of today
            if (age < 18) {
                return false;
            }
            
            // Additional check: if they're exactly 18, make sure their birthday has passed
            if (age === 18) {
                const thisYearBirthday = new Date(today.getFullYear(), birthMonth - 1, birthDay);
                return today >= thisYearBirthday;
            }
            
            return true; // 19 or older
        }

        function getValidationMessage(birthMonth, birthDay, birthYear) {
            const age = calculateAge(birthMonth, birthDay, birthYear);
            const isEligible = isAtLeast18Today(birthMonth, birthDay, birthYear);
            
            if (isEligible) {
                return { valid: true, message: `Valid: ${age} years old` };
            }
            
            const today = new Date();
            const nextBirthday = new Date(today.getFullYear(), birthMonth - 1, birthDay);
            
            // If birthday already passed this year, next birthday is next year
            if (nextBirthday < today) {
                nextBirthday.setFullYear(today.getFullYear() + 1);
            }
            
            if (age === 17) {
                const daysUntil18 = Math.ceil((nextBirthday - today) / (1000 * 60 * 60 * 24));
                return { 
                    valid: false, 
                    message: `Invalid: You must be 18 years old to register. You will turn 18 in ${daysUntil18} day${daysUntil18 === 1 ? '' : 's'}.` 
                };
            } else {
                return { valid: false, message: 'Invalid: You must be at least 18 years old to register' };
            }
        }

        function updateCurrentDateTime() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toDateString();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
        }

        function createResultDiv(description, birthDate, result) {
            const div = document.createElement('div');
            div.className = `p-3 rounded border ${result.valid ? 'bg-green-100 border-green-300' : 'bg-red-100 border-red-300'}`;
            
            div.innerHTML = `
                <p class="font-semibold">${description}</p>
                <p><strong>Birth Date:</strong> ${birthDate.toDateString()}</p>
                <p class="${result.valid ? 'text-green-700' : 'text-red-700'}">
                    <strong>Result:</strong> ${result.message}
                </p>
            `;
            
            return div;
        }

        function runEdgeCaseTests() {
            const resultsDiv = document.getElementById('edgeResults');
            resultsDiv.innerHTML = '';
            
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1;
            const currentDay = today.getDate();
            
            const tests = [
                // Critical edge cases
                [currentMonth, currentDay, currentYear - 18, "Exactly 18 years old TODAY"],
                [currentMonth, currentDay + 1, currentYear - 18, "Turns 18 TOMORROW (should be INVALID)"],
                [currentMonth, currentDay - 1, currentYear - 18, "Turned 18 YESTERDAY"],
                
                // More edge cases
                [currentMonth, currentDay, currentYear - 17, "17 years old (same date)"],
                [currentMonth - 1, currentDay, currentYear - 17, "17 years, 11 months old"],
                [currentMonth + 1, currentDay, currentYear - 18, "17 years old, birthday next month"],
                
                // Older ages
                [currentMonth, currentDay, currentYear - 19, "19 years old"],
                [currentMonth, currentDay, currentYear - 25, "25 years old"],
            ];
            
            tests.forEach(([month, day, year, description]) => {
                try {
                    // Handle month/day overflow
                    if (month > 12) month = 12;
                    if (month < 1) month = 1;
                    if (day > 31) day = 31;
                    if (day < 1) day = 1;
                    
                    const birthDate = new Date(year, month - 1, day);
                    const result = getValidationMessage(month, day, year);
                    const resultDiv = createResultDiv(description, birthDate, result);
                    resultsDiv.appendChild(resultDiv);
                } catch (error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'p-3 rounded bg-yellow-100 border border-yellow-300';
                    errorDiv.innerHTML = `
                        <p class="font-semibold">${description}</p>
                        <p class="text-yellow-700"><strong>Error:</strong> ${error.message}</p>
                    `;
                    resultsDiv.appendChild(errorDiv);
                }
            });
        }

        function testManualInput() {
            const month = parseInt(document.getElementById('testMonth').value);
            const day = parseInt(document.getElementById('testDay').value);
            const year = parseInt(document.getElementById('testYear').value);
            
            const resultDiv = document.getElementById('manualResult');
            
            try {
                const birthDate = new Date(year, month - 1, day);
                const result = getValidationMessage(month, day, year);
                
                resultDiv.innerHTML = '';
                const div = createResultDiv('Manual Test Result', birthDate, result);
                resultDiv.appendChild(div);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="p-3 rounded bg-yellow-100 border border-yellow-300">
                        <p class="text-yellow-700"><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        // Initialize
        updateCurrentDateTime();
        setInterval(updateCurrentDateTime, 1000); // Update time every second
        runEdgeCaseTests();
        
        // Set default test date to tomorrow for easy testing
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('testMonth').value = tomorrow.getMonth() + 1;
        document.getElementById('testDay').value = tomorrow.getDate();
        document.getElementById('testYear').value = tomorrow.getFullYear() - 18;
    </script>
</body>
</html>
