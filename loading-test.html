<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next Button Loading Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg">
        <h1 class="text-xl font-bold mb-4">Registration Step 1</h1>
        
        <!-- ID Type Selection -->
        <div class="mb-4">
            <label class="block text-sm font-medium mb-2">ID Type:</label>
            <div class="relative">
                <button id="idTypeDropdown" class="w-full p-3 border rounded-lg text-left bg-white">
                    <span id="selectedID">Driver's License</span>
                </button>
            </div>
        </div>
        
        <!-- File Upload -->
        <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Upload ID:</label>
            <input type="file" id="IDfileInput" accept="image/*" class="w-full p-3 border rounded-lg">
        </div>
        
        <!-- Next Button (Exact copy from register.html) -->
        <div class="mt-10">
            <button id="nextBtn1" type="button" class="group relative w-full btn rounded-full bg-blue-600 flex items-center justify-center overflow-hidden
            hover:cursor-pointer active:scale-95
            transition-all duration-500 ease-in-out px-6 py-3"
            data-step="1">
                <span class="text-white text-base group-hover:-translate-x-1
                transition-transform duration-500 ease-in-out 
                md:text-lg">Next</span>
                <span
                    class="overflow-hidden max-w-[30px] lg:max-w-0 lg:group-hover:max-w-[30px] transition-all duration-500 ease-in-out">
                    <svg class="w-5 h-5 ml-2 fill-white" viewBox="0 0 24 25"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M14.707 6.13598L20.364 11.793C20.5515 11.9805 20.6568 12.2348 20.6568 12.5C20.6568 12.7651 20.5515 13.0194 20.364 13.207L14.707 18.864C14.5184 19.0461 14.2658 19.1469 14.0036 19.1447C13.7414 19.1424 13.4906 19.0372 13.3052 18.8518C13.1198 18.6664 13.0146 18.4156 13.0123 18.1534C13.01 17.8912 13.1108 17.6386 13.293 17.45L17.243 13.5H4C3.73478 13.5 3.48043 13.3946 3.29289 13.2071C3.10536 13.0195 3 12.7652 3 12.5C3 12.2348 3.10536 11.9804 3.29289 11.7929C3.48043 11.6053 3.73478 11.5 4 11.5H17.243L13.293 7.54998C13.1975 7.45773 13.1213 7.34739 13.0689 7.22538C13.0165 7.10338 12.9889 6.97216 12.9877 6.83938C12.9866 6.7066 13.0119 6.57492 13.0622 6.45202C13.1125 6.32913 13.1867 6.21747 13.2806 6.12358C13.3745 6.02969 13.4861 5.95544 13.609 5.90516C13.7319 5.85487 13.8636 5.82957 13.9964 5.83073C14.1292 5.83188 14.2604 5.85947 14.3824 5.91188C14.5044 5.96428 14.6148 6.04047 14.707 6.13598Z" />
                    </svg>
                </span>
            </button>
        </div>
        
        <!-- Status Log -->
        <div id="statusLog" class="mt-6 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-semibold mb-2">Status Log:</h3>
            <div id="logMessages" class="text-sm space-y-1"></div>
        </div>
    </div>

    <script>
        // Logging function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('logMessages');
            const logItem = document.createElement('div');
            logItem.className = `p-2 rounded ${
                type === 'success' ? 'bg-green-100 text-green-800' : 
                type === 'error' ? 'bg-red-100 text-red-800' : 
                'bg-blue-100 text-blue-800'
            }`;
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logItem);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Mock functions
        function validateStep1() {
            const fileInput = document.getElementById('IDfileInput');
            const hasFile = fileInput.files && fileInput.files.length > 0;
            log(`Validation: File uploaded = ${hasFile}`, hasFile ? 'success' : 'error');
            return hasFile;
        }
        
        function showError(message) {
            log(`Error: ${message}`, 'error');
            alert(message);
        }
        
        async function scanDriversLicense(imageFile) {
            log(`Starting OCR scan for: ${imageFile.name}`, 'info');
            
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Simulate API response
            const mockData = {
                firstName: 'John',
                lastName: 'Doe',
                middleName: 'Michael',
                birthday: '1990/01/15'
            };
            
            log('OCR scan completed successfully', 'success');
            return mockData;
        }
        
        function autoFillFromOCR(ocrData) {
            log(`Auto-filling with: ${JSON.stringify(ocrData)}`, 'success');
        }
        
        // Setup button event listener
        document.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, setting up event listener', 'info');
            
            const nextBtn1 = document.getElementById('nextBtn1');
            if (nextBtn1) {
                nextBtn1.addEventListener('click', async (e) => {
                    e.preventDefault();
                    log('Next button clicked!', 'info');
                    
                    if (nextBtn1.disabled) {
                        log('Button is disabled, ignoring click', 'error');
                        return;
                    }
                    
                    // Show loading state
                    const textSpan = nextBtn1.querySelector('span');
                    const arrowSpan = nextBtn1.querySelector('span:last-child');
                    const originalText = textSpan.textContent;
                    
                    log('Setting loading state...', 'info');
                    nextBtn1.disabled = true;
                    nextBtn1.classList.add('opacity-75');
                    textSpan.textContent = 'Processing...';
                    arrowSpan.innerHTML = `
                        <svg class="w-5 h-5 ml-2 animate-spin text-white" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    `;
                    
                    try {
                        if (!validateStep1()) {
                            log('Validation failed', 'error');
                            return;
                        }
                        
                        const fileInput = document.getElementById('IDfileInput');
                        const imageFile = fileInput.files[0];
                        
                        // Perform OCR scan
                        const ocrData = await scanDriversLicense(imageFile);
                        
                        // Auto-fill
                        autoFillFromOCR(ocrData);
                        
                        log('Would proceed to Step 2 now', 'success');
                        
                    } catch (error) {
                        log(`Error: ${error.message}`, 'error');
                        showError(error.message);
                    } finally {
                        // Reset button
                        log('Resetting button state...', 'info');
                        nextBtn1.disabled = false;
                        nextBtn1.classList.remove('opacity-75');
                        textSpan.textContent = originalText;
                        arrowSpan.innerHTML = `
                            <svg class="w-5 h-5 ml-2 fill-white" viewBox="0 0 24 25"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M14.707 6.13598L20.364 11.793C20.5515 11.9805 20.6568 12.2348 20.6568 12.5C20.6568 12.7651 20.5515 13.0194 20.364 13.207L14.707 18.864C14.5184 19.0461 14.2658 19.1469 14.0036 19.1447C13.7414 19.1424 13.4906 19.0372 13.3052 18.8518C13.1198 18.6664 13.0146 18.4156 13.0123 18.1534C13.01 17.8912 13.1108 17.6386 13.293 17.45L17.243 13.5H4C3.73478 13.5 3.48043 13.3946 3.29289 13.2071C3.10536 13.0195 3 12.7652 3 12.5C3 12.2348 3.10536 11.9804 3.29289 11.7929C3.48043 11.6053 3.73478 11.5 4 11.5H17.243L13.293 7.54998C13.1975 7.45773 13.1213 7.34739 13.0689 7.22538C13.0165 7.10338 12.9889 6.97216 12.9877 6.83938C12.9866 6.7066 13.0119 6.57492 13.0622 6.45202C13.1125 6.32913 13.1867 6.21747 13.2806 6.12358C13.3745 6.02969 13.4861 5.95544 13.609 5.90516C13.7319 5.85487 13.8636 5.82957 13.9964 5.83073C14.1292 5.83188 14.2604 5.85947 14.3824 5.91188C14.5044 5.96428 14.6148 6.04047 14.707 6.13598Z" />
                            </svg>
                        `;
                        log('Button state reset complete', 'success');
                    }
                });
                
                log('Event listener attached successfully', 'success');
            } else {
                log('Could not find nextBtn1 button!', 'error');
            }
        });
        
        // File upload handler
        document.getElementById('IDfileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                log(`File selected: ${file.name} (${file.size} bytes)`, 'success');
            }
        });
    </script>
</body>
</html>
